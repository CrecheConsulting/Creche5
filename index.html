<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolveED Strategic | ECE Launch & Compliance Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; scroll-behavior: smooth; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin: auto; height: 350px; max-height: 400px; }
        .tab-active { border-bottom: 4px solid #2563eb; color: #2563eb; font-weight: 800; }
        .tab-inactive { color: #64748b; border-bottom: 4px solid transparent; }
        .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60% { content: '...'; } 80%, 100% { content: ''; } }
        .card-shadow { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .error-msg { background: #fee; color: #c00; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fcc; }
    </style>
</head>
<body class="antialiased">

    <nav class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-extrabold text-xl">S</div>
                    <span class="font-extrabold text-xl tracking-tight text-slate-900">SolveED <span class="text-blue-600 font-medium">Strategy</span></span>
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="#roadmap" class="text-sm font-bold text-slate-600 hover:text-blue-600 transition">Roadmap</a>
                    <a href="#calculator" class="text-sm font-bold text-slate-600 hover:text-blue-600 transition">Space Engineer</a>
                    <a href="#ai-lab" class="text-blue-600 font-extrabold">‚ú® AI Compliance Lab</a>
                </div>
                <button class="bg-slate-900 text-white px-5 py-2 rounded-xl text-sm font-bold shadow-lg">Client Portal</button>
            </div>
        </div>
    </nav>

    <header class="bg-slate-900 py-16 md:py-24 text-center relative overflow-hidden">
        <div class="max-w-5xl mx-auto px-4 relative z-10">
            <h1 class="text-4xl md:text-6xl font-extrabold text-white mb-6">Expert <span class="text-blue-400">Tusla Registration</span> Hub</h1>
            <p class="text-xl text-slate-400 max-w-2xl mx-auto leading-relaxed">
                Strategic support for 17-place boutique creches. From planning to ongoing compliance mastery.
            </p>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-16 space-y-24">

        <!-- Section 1: Roadmap Timeline -->
        <section id="roadmap" class="scroll-mt-24">
            <div class="text-center mb-16">
                <h2 class="text-3xl font-extrabold text-slate-900 uppercase">Project Lifecycle</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-3xl card-shadow border border-slate-100">
                    <div class="text-blue-600 font-black text-2xl mb-4">Phase A</div>
                    <h3 class="font-bold text-slate-900 mb-2">Premises</h3>
                    <p class="text-xs text-slate-500 mb-4">6-12 MONTHS</p>
                    <p class="text-sm text-slate-600">Planning permission & Fire Safety Certification.</p>
                </div>
                <div class="bg-white p-6 rounded-3xl card-shadow border border-slate-100">
                    <div class="text-emerald-600 font-black text-2xl mb-4">Phase B</div>
                    <h3 class="font-bold text-slate-900 mb-2">Registration</h3>
                    <p class="text-xs text-slate-500 mb-4">90 DAYS</p>
                    <p class="text-sm text-slate-600">Tusla portal submission & Policy drafting.</p>
                </div>
                <div class="bg-white p-6 rounded-3xl card-shadow border border-slate-100">
                    <div class="text-rose-600 font-black text-2xl mb-4">Phase C</div>
                    <h3 class="font-bold text-slate-900 mb-2">Staffing</h3>
                    <p class="text-xs text-slate-500 mb-4">60 DAYS</p>
                    <p class="text-sm text-slate-600">Garda Vetting & Reference audits.</p>
                </div>
                <div class="bg-indigo-600 p-6 rounded-3xl shadow-xl border border-indigo-500 text-white">
                    <div class="font-black text-2xl mb-4">Phase D</div>
                    <h3 class="font-bold mb-2">Monthly Retainer</h3>
                    <p class="text-xs text-indigo-200 mb-4 font-bold uppercase tracking-widest">Ongoing Support</p>
                    <p class="text-sm opacity-90">Continuous training, quick consultations, and regulation updates.</p>
                    <div class="mt-4 pt-4 border-t border-indigo-400 font-black text-xl">‚Ç¨150<small class="font-normal text-sm">/mo</small></div>
                </div>
            </div>
        </section>

        <!-- Section 2: Space Engineer -->
        <section id="calculator" class="scroll-mt-24">
            <div class="bg-white rounded-[2.5rem] p-8 md:p-12 card-shadow border border-slate-100">
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <div class="space-y-8">
                        <h2 class="text-3xl font-extrabold text-slate-900">Space Engineer (17 Capacity)</h2>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-bold text-slate-700">Wobblers (2.8m¬≤)</span>
                                <span id="wobblerCount" class="font-black text-blue-600 text-2xl">7</span>
                            </div>
                            <input type="range" id="wobblerSlider" min="0" max="17" value="7" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                        </div>
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="font-bold text-slate-700">Toddlers (2.32m¬≤)</span>
                                <span id="toddlerCount" class="font-black text-emerald-600 text-2xl">10</span>
                            </div>
                            <input type="range" id="toddlerSlider" min="0" max="17" value="10" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-600">
                        </div>
                        <div class="p-6 bg-slate-50 rounded-2xl border border-slate-100 flex justify-between items-center">
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase">Total Net Area Req.</p>
                                <p class="text-4xl font-black text-slate-900" id="totalSpace">42.8 m¬≤</p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs font-bold text-slate-400 uppercase">Current Capacity</p>
                                <p class="text-4xl font-black text-blue-600" id="totalChildren">17/17</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="spaceChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: AI Lab -->
        <section id="ai-lab" class="scroll-mt-24">
            <div class="bg-slate-900 rounded-[2.5rem] p-8 md:p-12 shadow-2xl relative">
                <div class="max-w-3xl mb-8">
                    <h2 class="text-3xl font-extrabold text-white mb-4">‚ú® AI Compliance Laboratory</h2>
                    <p class="text-slate-400">Intelligent policy auditing and inspection simulations using Gemini AI.</p>
                </div>
                
                <!-- API Key Input -->
                <div class="mb-6 bg-slate-800 p-4 rounded-xl border border-yellow-600">
                    <label class="block text-yellow-400 font-bold mb-2 text-sm">üîë Gemini API Key (Required)</label>
                    <input type="password" id="apiKeyInput" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-slate-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ingresa tu API Key de Google AI Studio...">
                    <p class="text-xs text-slate-500 mt-2">Obt√©n tu clave gratis en: <a href="https://aistudio.google.com/apikey" target="_blank" class="text-blue-400 underline">aistudio.google.com/apikey</a></p>
                </div>

                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <textarea id="aiInput" class="w-full h-48 bg-slate-800 border border-slate-700 rounded-2xl p-6 text-slate-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Paste your policy text or describe a room scenario..."></textarea>
                        <div class="flex flex-wrap gap-4">
                            <button onclick="runAILogic('audit')" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-bold transition hover:bg-blue-500">Audit Policy ‚ú®</button>
                            <button onclick="runAILogic('sim')" class="bg-emerald-600 text-white px-6 py-3 rounded-xl font-bold transition hover:bg-emerald-500">Inspection Sim ‚ú®</button>
                            <button onclick="speakResponse()" class="bg-slate-700 text-white px-6 py-3 rounded-xl font-bold hover:bg-slate-600">üîä Listen</button>
                        </div>
                    </div>
                    <div class="bg-slate-800 rounded-2xl p-8 border border-slate-700 min-h-[300px] relative overflow-hidden">
                        <div id="aiLoading" class="hidden absolute inset-0 bg-slate-800/90 backdrop-blur-sm z-50 flex flex-col items-center justify-center">
                            <div class="w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
                            <p class="mt-4 text-blue-400 font-bold loading-dots uppercase tracking-widest text-xs">Analyzing</p>
                        </div>
                        <div id="aiOutput" class="text-slate-300 text-sm leading-relaxed whitespace-pre-wrap h-full overflow-y-auto">
                            <p class="text-slate-600 italic">// AI report will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-slate-50 border-t border-slate-200 py-12 text-center">
        <p class="text-slate-500 font-extrabold text-lg">SolveED Strategy Hub | 2026</p>
        <p class="text-slate-400 text-sm mt-2">Compliance Support for Irish Early Years Services.</p>
    </footer>

    <script>
        // --- SPACE CALCULATOR ---
        const wobblerSlider = document.getElementById('wobblerSlider');
        const toddlerSlider = document.getElementById('toddlerSlider');
        const spaceCtx = document.getElementById('spaceChart').getContext('2d');
        
        let spaceChart = new Chart(spaceCtx, {
            type: 'bar',
            data: {
                labels: ['Wobbler Space', 'Toddler Space', 'Total Used', 'Max Area (45m¬≤)'],
                datasets: [{
                    data: [19.6, 23.2, 42.8, 45],
                    backgroundColor: ['#2563eb', '#10b981', '#1e293b', '#cbd5e1'],
                    borderRadius: 8
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false } },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { color: '#94a3b8' },
                        grid: { color: '#334155' }
                    },
                    x: {
                        ticks: { color: '#94a3b8' },
                        grid: { display: false }
                    }
                }
            }
        });

        function updateSpace() {
            let w = parseInt(wobblerSlider.value);
            let t = parseInt(toddlerSlider.value);
            if ((w + t) > 17) { t = 17 - w; toddlerSlider.value = t; }

            const wSpace = (w * 2.8).toFixed(1);
            const tSpace = (t * 2.32).toFixed(1);
            const total = (parseFloat(wSpace) + parseFloat(tSpace)).toFixed(1);

            document.getElementById('wobblerCount').innerText = w;
            document.getElementById('toddlerCount').innerText = t;
            document.getElementById('totalChildren').innerText = (w + t) + "/17";
            document.getElementById('totalSpace').innerText = total + " m¬≤";

            spaceChart.data.datasets[0].data = [wSpace, tSpace, total, 45];
            spaceChart.update();
        }
        wobblerSlider.oninput = updateSpace;
        toddlerSlider.oninput = updateSpace;

        // --- AI LOGIC (FIXED) ---
        const TEXT_MODEL = "gemini-2.0-flash-exp";
        
        function getApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) {
                throw new Error("Por favor ingresa tu API Key de Gemini");
            }
            return key;
        }

        async function fetchWithRetry(url, payload, retries = 3) {
            let delay = 1000;
            let lastError;
            
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return await response.json();
                } catch (e) {
                    lastError = e;
                    console.error(`Intento ${i + 1} fall√≥:`, e);
                    if (i < retries - 1) {
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                    }
                }
            }
            throw lastError;
        }

        async function runAILogic(type) {
            const input = document.getElementById('aiInput').value.trim();
            const output = document.getElementById('aiOutput');
            const loader = document.getElementById('aiLoading');
            
            try {
                const apiKey = getApiKey();
                loader.classList.remove('hidden');
                output.innerHTML = '<p class="text-slate-600 italic">// Processing...</p>';
                
                const systemPrompts = {
                    audit: `You are an expert Tusla Early Years Inspector for Ireland. 

Analyze the provided childcare policy against Ireland's Quality and Regulatory Framework (QRF) standards.

Provide:
1. COMPLIANCE RATING (Excellent/Good/Needs Improvement/Non-Compliant)
2. KEY STRENGTHS (2-3 points)
3. AREAS FOR IMPROVEMENT (specific gaps)
4. CRITICAL ISSUES (if any - safety/regulatory violations)
5. RECOMMENDATIONS (actionable steps)

Be professional, specific, and cite relevant QRF standards where applicable.`,
                    
                    sim: `You are a Tusla Early Years Inspector conducting a surprise inspection at a 17-place boutique creche in Ireland.

Generate a realistic inspection scenario including:
1. INSPECTION FOCUS (e.g., safety equipment, staff ratios, hygiene, documentation)
2. OBSERVATION (what you notice during the visit)
3. NON-COMPLIANCE ISSUE (realistic problem found - be specific)
4. SEVERITY LEVEL (Minor/Moderate/Serious)
5. IMMEDIATE ACTION REQUIRED (what the provider must do)
6. FOLLOW-UP TIMEFRAME

Make it realistic and educational. Base findings on actual QRF requirements.`
                };
                
                const userQuery = input || (type === 'audit' 
                    ? "Please provide a sample policy for analysis, or generate a generic audit checklist for a 17-place creche."
                    : "Generate a random but realistic inspection scenario.");
                
                const url = `https://generativelanguage.googleapis.com/v1beta/models/${TEXT_MODEL}:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: userQuery }]
                    }],
                    systemInstruction: {
                        parts: [{ text: systemPrompts[type] }]
                    },
                    generationConfig: {
                        temperature: 0.7,
                        maxOutputTokens: 2048
                    }
                };

                const data = await fetchWithRetry(url, payload);
                
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    output.innerText = data.candidates[0].content.parts[0].text;
                } else {
                    throw new Error("No se recibi√≥ respuesta v√°lida del modelo");
                }
                
            } catch (e) {
                output.innerHTML = `<div class="error-msg">
                    <strong>‚ö†Ô∏è Error:</strong> ${e.message}
                    <br><br>
                    <small>Verifica que tu API Key sea correcta y que tengas cuota disponible en Google AI Studio.</small>
                </div>`;
                console.error("Error completo:", e);
            } finally {
                loader.classList.add('hidden');
            }
        }

        async function speakResponse() {
            const text = document.getElementById('aiOutput').innerText;
            const loader = document.getElementById('aiLoading');
            
            if (!text || text.includes('//') || text.includes('‚ö†Ô∏è')) {
                alert("No hay texto v√°lido para leer. Ejecuta primero una auditor√≠a o simulaci√≥n.");
                return;
            }
            
            try {
                const apiKey = getApiKey();
                loader.classList.remove('hidden');
                
                // Usar Web Speech API nativo (m√°s confiable)
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text.substring(0, 1000));
                    utterance.lang = 'en-IE'; // Ingl√©s de Irlanda
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    
                    // Buscar voz irlandesa si est√° disponible
                    const voices = speechSynthesis.getVoices();
                    const irishVoice = voices.find(v => v.lang.includes('en-IE') || v.lang.includes('en-GB'));
                    if (irishVoice) utterance.voice = irishVoice;
                    
                    speechSynthesis.speak(utterance);
                } else {
                    throw new Error("Text-to-speech no est√° soportado en tu navegador");
                }
                
            } catch (e) {
                alert("Error al reproducir audio: " + e.message);
            } finally {
                loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
